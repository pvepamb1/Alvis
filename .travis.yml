language: java
sudo: required
env:
    matrix:
      - OS=ubuntu DIST=xenial
before_install:
  - chmod +x gradlew
  - mysql -e 'CREATE DATABASE home_dev;'
services:
  - mysql
  - docker
cache:
    directories:
     - $HOME/.cache
script:
  - ./gradlew build --info
  - git submodule update --init --recursive
  - git describe --long
  - git clone https://github.com/packpack/packpack.git packpack
  - packpack/packpack
  - pwd
  - ls
deploy:
  provider: packagecloud
  username: ${PACKAGECLOUD_USER}
  repository: ${PACKAGECLOUD_REPO}
  token: ${PACKAGECLOUD_TOKEN}
  dist: ${OS}/${DIST}
  package_glob: build/*.deb
  skip_cleanup: true
  on:
    condition: -n "${OS}" && -n "${DIST}" && -n "${PACKAGECLOUD_TOKEN}"
